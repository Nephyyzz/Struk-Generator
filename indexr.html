<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struk Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
<style>
    body {
        font-family: 'Roboto', sans-serif;
        background-color: #f4f4f4;
    }
    .container {
        max-width: 800px;
        margin-top: 50px;
    }
    .receipt-container {
        border: 1px dashed #000;
        padding: 20px;
        margin-top: 30px;
        width: 100%;
        margin: auto;
        background-color: white;
        text-align: center;
        font-family: 'Courier New', Courier, monospace;
        box-sizing: border-box;
        max-width: 350px;
        word-wrap: break-word;
    }
    .input-group {
        margin-bottom: 10px;
    }
    #product-list {
        margin-top: 15px;
    }
    .input-group button {
        margin-top: 5px;
    }
    .receipt-header, .receipt-footer {
        font-weight: bold;
    }
    .receipt-content {
        text-align: center;
        margin-top: 10px;
        padding: 10px;
    }
    .total-price {
        font-size: 16px;
        font-weight: bold;
    }
    .btn-success, .btn-primary, .btn-danger {
        width: 100%;
        font-family: 'Courier New', Courier, monospace;
    }
    .receipt-content p {
        margin: 0;
    }
    pre {
        white-space: pre-wrap; 
        word-wrap: break-word;
        font-size: 14px;
        text-align: center;
        margin: 0;
        padding: 0;
    }
    .input-group input {
        font-family: 'Courier New', Courier, monospace;
    }
    .product-item {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 5px;
        text-align: center;
    }
    .receipt-footer p {
        margin-top: 20px;
    }
    .centered-item {
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 5px 0;
        width: 100%;
    }
    .centered-item span {
        width: 50%; 
        text-align: center;
    }
    .product-item {
        margin-bottom: 10px;
    }
    .product-item button {
            background-color: transparent; 
            border: none; 
            cursor: pointer; 
            padding: 0; 
            font-size: 20px; 
            color: #000; 
    }
    .product-item button:hover {
            color: red; 
     }

     .product-item span {
            display:inline-block; 
            width :50%; 
            text-align :center; 
     }

     .receipt-content .product-list { 
            display:flex; 
            flex-direction :column; 
            align-items:center; 
     } 

     .receipt-content .product-list div { 
            display:flex; 
            justify-content :space-between; 
            width :100%; 
            text-align:center; 
            padding :3px 0; 
     } 

.footer {  
         position :relative;  
         margin-top :50px;  
         text-align:center;  
         color :#333;  
         font-size :14px;  
} 

.footer p {  
         margin :5px 0;  
} 

.footer a {  
         text-decoration:none;  
         color:#333;  
         font-weight:bold;  
} 

.footer a:hover {  
         color:#555;  
}
</style>
</head>
<body>

<div class="container">
    <h1 class="text-center mt-5">Struk Generator</h1>
    
    <div class="row justify-content-center mt-3">
        <div class="col-md-6">
            <div class="input-group">
                <input type="text" class="form-control" id="store-name" placeholder="Nama Toko">
            </div>
            <div class="input-group">
                <input type="text" class="form-control" id="transaction-id" placeholder="ID Transaksi">
            </div>
            <div class="input-group">
                <input type="text" class="form-control" id="customer-number" placeholder="Nomor Pelanggan">
            </div>
            <div class="input-group">
                <input type="number" class="form-control" id="admin-price" placeholder="Harga Admin">
            </div>
            <div class="input-group">
                <input type="text" class="form-control" id="product-name" placeholder="Nama Barang">
                <input type="number" class="form-control" id="product-price" placeholder="Harga Barang">
                <button class="btn btn-primary" onclick="addProduct()">Tambah Barang</button>
            </div>
            <div id="product-list"></div>
            <button class="btn btn-danger mt-3" onclick="clearProducts()">Hapus List Barang</button>
        </div>
    </div>
    
    <div id="receipt" class="receipt-container mt-5">
        <div id="receipt-content"></div>
    </div>

    <div class="text-center mt-3">
        <button class="btn btn-success" onclick="downloadReceipt()">Download Struk (JPG)</button>
    </div>
    
<div class="footer">
    <p>Project by <strong>Nephyy</strong></p>
    <p>
        <a href="https://github.com/Nephyyzz" target="_blank" title="GitHub Profile">
            <i class="fa fa-github" style="font-size: 24px;"></i> View my GitHub
        </a>
    </p>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
    let products = [];

    function formatRupiah(amount) {
        return new Intl.NumberFormat('id-ID', {
            style: 'currency',
            currency: 'IDR',
        }).format(amount);
    }

    function addProduct() {
        const productName = document.getElementById('product-name').value;
        const productPrice = document.getElementById('product-price').value;
        
        if (productName && productPrice) {
            products.push({ name: productName, price: productPrice });
            renderReceipt();
            document.getElementById('product-name').value = ''; 
            document.getElementById('product-price').value = '';
            renderProductList();
        }
    }

    function removeProduct(index) {
        products.splice(index, 1);
        renderReceipt();
        renderProductList();
    }

    function clearProducts() {
        products = [];
        renderReceipt();
        renderProductList();
    }

    function renderReceipt() {
        const storeName = document.getElementById('store-name').value || 'Nama Toko';
        const transactionId = document.getElementById('transaction-id').value || 'ID Transaksi';
        const customerNumber = document.getElementById('customer-number').value || 'Nomor Pelanggan';
        const adminPrice = document.getElementById('admin-price').value || '0';
        
        let total = 0;
        let productDetails = '';
        products.forEach((product) => {
            productDetails += `- ${product.name.padEnd(20, ' ')}${formatRupiah(product.price).padStart(10, ' ')}\n`;
            total += parseFloat(product.price);
        });

        const currentDate = new Date().toLocaleDateString('id-ID');

        const receiptHtml = `
============================
    ${storeName}
============================
ID Transaksi: ${transactionId}
Nomor Pelanggan: ${customerNumber}

Barang:
${productDetails}----------------------------
Harga Admin: ${formatRupiah(adminPrice)}
Total Harga: ${formatRupiah(total + parseFloat(adminPrice))}

Tanggal Pembelian: ${currentDate}

============================
Terima Kasih telah berbelanja
   di ${storeName}!
============================
        `;

        document.getElementById('receipt-content').innerText = receiptHtml;
    }

    function renderProductList() {
        const productListContainer = document.getElementById('product-list');
        productListContainer.innerHTML = '';

        products.forEach((product, index) => {
            const productItem = document.createElement('div');
            productItem.classList.add('product-item');
            productItem.innerHTML = `
                <span>${product.name}</span>
                <span>${formatRupiah(product.price)}</span>
                <button onclick="removeProduct(${index})">üóëÔ∏è</button>
            `;
            productListContainer.appendChild(productItem);
        });
    }

    function downloadReceipt() {
        const receipt = document.getElementById('receipt');
        if (!receipt) {
            alert('Tidak ada struk untuk diunduh.');
            return;
        }

        html2canvas(receipt, { scale: 2 }).then(function(canvas) {
            const link = document.createElement('a');
            link.download = 'struk.jpg';
            link.href = canvas.toDataURL('image/jpeg');
            link.click();
        }).catch(function(error) {
            console.error('Terjadi kesalahan saat mengunduh struk:', error);
            alert('Terjadi kesalahan. Silakan coba lagi.');
        });
    }
</script>

</body>
</html>
